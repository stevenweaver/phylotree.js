<!DOCTYPE html>
<html>
<head>
    <title>Phylotree.js Observable Compatibility Test</title>
    <meta charset="utf-8">
</head>
<body>
    <h1>Testing Phylotree.js for Observable Compatibility</h1>
    <div id="status"></div>
    
    <script type="module">
        // Simulate Observable-like environment by loading as ES module
        const statusDiv = document.getElementById('status');
        
        try {
            // First load dependencies
            const _ = await import('https://cdn.skypack.dev/underscore');
            const lodash = await import('https://cdn.skypack.dev/lodash');
            
            // Make them global as phylotree expects
            window._ = _.default;
            window._$1 = lodash.default;
            
            // Now try to load phylotree
            const script = document.createElement('script');
            script.src = './dist/phylotree.js';
            script.onload = () => {
                if (typeof phylotree !== 'undefined') {
                    statusDiv.innerHTML = '<p style="color: green;">✅ Phylotree loaded successfully without Node.js dependency errors!</p>';
                    
                    // Test basic functionality
                    try {
                        const tree = new phylotree.phylotree("(A:0.1,B:0.2,(C:0.3,D:0.4):0.5);");
                        statusDiv.innerHTML += '<p style="color: green;">✅ Successfully created a phylogenetic tree</p>';
                        statusDiv.innerHTML += '<p>Available methods: ' + Object.keys(phylotree).join(', ') + '</p>';
                    } catch (e) {
                        statusDiv.innerHTML += '<p style="color: red;">❌ Error using phylotree: ' + e.message + '</p>';
                    }
                } else {
                    statusDiv.innerHTML = '<p style="color: red;">❌ Phylotree not loaded</p>';
                }
            };
            script.onerror = (e) => {
                statusDiv.innerHTML = '<p style="color: red;">❌ Failed to load phylotree.js: ' + e + '</p>';
            };
            document.head.appendChild(script);
            
        } catch (error) {
            statusDiv.innerHTML = '<p style="color: red;">❌ Error: ' + error.message + '</p>';
        }
    </script>
</body>
</html>